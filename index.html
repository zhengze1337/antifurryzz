<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B站话题用户分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FB7299',
                        secondary: '#23ADE5',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-all;
            }
            .btn-secondary {
                @apply bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-all;
            }
            .input-field {
                @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i class="fa fa-play-circle text-primary text-3xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">B站话题用户分析</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fa fa-moon-o text-gray-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 控制面板 -->
        <section class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">用户数据管理</h2>
                    <p class="text-gray-600">查看和分析B站用户数据</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                    <button id="refresh-data" class="btn-primary">
                        <i class="fa fa-refresh mr-2"></i> 刷新数据
                    </button>
                    <button id="sort-by-follower" class="btn-secondary">
                        <i class="fa fa-sort-numeric-desc mr-2"></i> 按粉丝数排序
                    </button>
                </div>
            </div>
        </section>

        <!-- 搜索和筛选 -->
        <section class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center gap-4">
                <div class="relative w-full md:w-1/2">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-user" placeholder="搜索用户名..." class="input-field pl-10">
                </div>
                <div class="flex flex-wrap gap-3">
                    <div class="relative">
                        <select id="filter-follower" class="input-field pr-10 appearance-none bg-white">
                            <option value="all">所有用户</option>
                            <option value="10k+">10K+ 粉丝</option>
                            <option value="100k+">100K+ 粉丝</option>
                            <option value="1m+">1M+ 粉丝</option>
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <div class="relative">
                        <select id="sort-order" class="input-field pr-10 appearance-none bg-white">
                            <option value="desc">降序</option>
                            <option value="asc">升序</option>
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- 用户列表 -->
        <section class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">用户列表</h2>
                <div class="text-sm text-gray-500">
                    显示 <span id="showing-users">0</span> 个用户
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">排名</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">用户信息</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">粉丝数</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="user-list">
                        <!-- 用户数据将通过JavaScript动态填充 -->
                        <tr>
                            <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-spinner fa-spin text-4xl mb-4 text-gray-300"></i>
                                    <p>正在加载用户数据...</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 分页控件 -->
            <div class="flex items-center justify-between mt-6">
                <div class="text-sm text-gray-500">
                    每页显示 <select id="page-size" class="border rounded px-2 py-1 text-sm">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select> 条记录
                </div>
                <div class="flex items-center space-x-2">
                    <button id="prev-page" class="px-3 py-1 border rounded text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <span id="page-info" class="text-sm text-gray-700">第 1 页，共 1 页</span>
                    <button id="next-page" class="px-3 py-1 border rounded text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-6">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>B站话题用户分析工具 &copy; 2025</p>
        </div>
    </footer>

    <!-- 用户详情模态框 -->
    <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800" id="modal-username">用户详情</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex flex-col md:flex-row gap-6" id="modal-content">
                    <div class="w-full md:w-1/3 flex flex-col items-center">
                        <img id="modal-avatar" src="https://picsum.photos/200/200" alt="用户头像" class="w-32 h-32 rounded-full object-cover border-4 border-primary/20">
                        <div class="mt-4 text-center">
                            <div class="flex items-center justify-center space-x-2 mb-2">
                                <span id="modal-mid" class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm">UID: 000000</span>
                            </div>
                            <a id="modal-url" href="#" target="_blank" class="text-primary hover:underline">
                                <i class="fa fa-external-link mr-1"></i> 查看B站主页
                            </a>
                        </div>
                    </div>
                    <div class="w-full md:w-2/3">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-xs text-gray-500">粉丝数</p>
                                <p id="modal-follower" class="text-lg font-bold">0</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-xs text-gray-500">排名</p>
                                <p id="modal-rank" class="text-lg font-bold">#0</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-gray-800 mb-2">用户数据详情</h4>
                            <pre id="modal-json" class="text-sm bg-gray-800 text-white p-3 rounded-lg overflow-x-auto max-h-64"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let userData = [];
        let filteredData = [];
        let currentPage = 1;
        let pageSize = 20;
        
        // 数据文件路径 - 修改为你的GitHub raw链接
        // 示例: https://raw.githubusercontent.com/your-username/your-repo/main/bilibili_topic_users.json
        const DATA_FILE_PATH = "https://raw.githubusercontent.com/your-username/your-repo/main/bilibili_topic_users.json";
        
        // DOM元素
        const userList = document.getElementById('user-list');
        const sortByFollower = document.getElementById('sort-by-follower');
        const searchUser = document.getElementById('search-user');
        const filterFollower = document.getElementById('filter-follower');
        const sortOrder = document.getElementById('sort-order');
        const pageInfo = document.getElementById('page-info');
        const prevPage = document.getElementById('prev-page');
        const nextPage = document.getElementById('next-page');
        const pageSizeSelect = document.getElementById('page-size');
        const showingUsers = document.getElementById('showing-users');
        const userModal = document.getElementById('user-modal');
        const closeModal = document.getElementById('close-modal');
        const modalUsername = document.getElementById('modal-username');
        const modalAvatar = document.getElementById('modal-avatar');
        const modalMid = document.getElementById('modal-mid');
        const modalUrl = document.getElementById('modal-url');
        const modalFollower = document.getElementById('modal-follower');
        const modalRank = document.getElementById('modal-rank');
        const modalJson = document.getElementById('modal-json');
        const navbar = document.getElementById('navbar');
        const themeToggle = document.getElementById('theme-toggle');
        const refreshData = document.getElementById('refresh-data');
        
        // 页面加载时自动加载数据
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // 滚动时导航栏样式变化
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    navbar.classList.add('shadow-lg', 'bg-white/95', 'backdrop-blur-sm');
                } else {
                    navbar.classList.remove('shadow-lg', 'bg-white/95', 'backdrop-blur-sm');
                }
            });
            
            // 主题切换
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                const icon = themeToggle.querySelector('i');
                if (icon.classList.contains('fa-moon-o')) {
                    icon.classList.remove('fa-moon-o');
                    icon.classList.add('fa-sun-o');
                } else {
                    icon.classList.remove('fa-sun-o');
                    icon.classList.add('fa-moon-o');
                }
            });
        });
        
        // 加载数据
        function loadData() {
            showLoading();
            
            fetch(DATA_FILE_PATH)
                .then(response => response.json())
                .then(data => {
                    userData = data;
                    // 过滤掉没有粉丝数的用户
                    userData = userData.filter(user => user.follower !== '未知');
                    filteredData = [...userData];
                    sortData('desc');
                    renderUserList();
                    updatePagination();
                });
        }
        
        // 刷新数据
        refreshData.addEventListener('click', loadData);
        
        // 按粉丝数排序
        sortByFollower.addEventListener('click', () => {
            if (userData.length === 0) return;
            
            // 切换排序方向
            const currentOrder = sortOrder.value;
            sortOrder.value = currentOrder === 'desc' ? 'asc' : 'desc';
            sortData(sortOrder.value);
            renderUserList();
        });
        
        // 搜索用户
        searchUser.addEventListener('input', () => {
            filterData();
        });
        
        // 筛选粉丝数
        filterFollower.addEventListener('change', () => {
            filterData();
        });
        
        // 排序方向变更
        sortOrder.addEventListener('change', () => {
            sortData(sortOrder.value);
            renderUserList();
        });
        
        // 每页显示数量变更
        pageSizeSelect.addEventListener('change', () => {
            pageSize = parseInt(pageSizeSelect.value);
            currentPage = 1;
            renderUserList();
            updatePagination();
        });
        
        // 上一页
        prevPage.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderUserList();
                updatePagination();
            }
        });
        
        // 下一页
        nextPage.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderUserList();
                updatePagination();
            }
        });
        
        // 关闭模态框
        closeModal.addEventListener('click', () => {
            userModal.classList.add('hidden');
        });
        
        // 点击模态框外部关闭
        userModal.addEventListener('click', (e) => {
            if (e.target === userModal) {
                userModal.classList.add('hidden');
            }
        });
        
        // 数据筛选
        function filterData() {
            const searchTerm = searchUser.value.toLowerCase();
            const followerFilter = filterFollower.value;
            
            filteredData = userData.filter(user => {
                // 搜索过滤
                const nameMatch = user.name.toLowerCase().includes(searchTerm);
                
                // 粉丝数过滤
                let followerMatch = true;
                const follower = parseInt(user.follower);
                
                switch (followerFilter) {
                    case '10k+':
                        followerMatch = follower >= 10000;
                        break;
                    case '100k+':
                        followerMatch = follower >= 100000;
                        break;
                    case '1m+':
                        followerMatch = follower >= 1000000;
                        break;
                    default:
                        followerMatch = true;
                }
                
                return nameMatch && followerMatch;
            });
            
            // 应用当前排序
            sortData(sortOrder.value);
            
            // 重置页码
            currentPage = 1;
            
            // 更新显示
            renderUserList();
            updatePagination();
        }
        
        // 数据排序
        function sortData(order) {
            filteredData.sort((a, b) => {
                const followerA = parseInt(a.follower);
                const followerB = parseInt(b.follower);
                
                if (order === 'desc') {
                    return followerB - followerA;
                } else {
                    return followerA - followerB;
                }
            });
        }
        
        // 渲染用户列表
        function renderUserList() {
            if (filteredData.length === 0) {
                userList.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <i class="fa fa-search text-4xl mb-4 text-gray-300"></i>
                                <p>没有找到匹配的用户</p>
                            </div>
                        </td>
                    </tr>
                `;
                showingUsers.textContent = '0';
                return;
            }
            
            // 计算当前页显示的数据
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredData.length);
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // 更新显示的用户数量
            showingUsers.textContent = filteredData.length;
            
            // 渲染用户列表
            userList.innerHTML = currentData.map((user, index) => {
                const rank = startIndex + index + 1;
                const follower = formatNumber(user.follower);
                
                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${rank}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full object-cover border-2 border-gray-200" 
                                         src="${user.avatar}" 
                                         alt="${user.name}"
                                         onerror="this.src='https://picsum.photos/100/100?random=${user.mid}'"
                                    >
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                    <div class="text-sm text-gray-500">UID: ${user.mid}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="text-sm font-medium ${getFollowerColor(user.follower)}">${follower}</div>
                                <div class="ml-2">
                                    ${getFollowerBadge(user.follower)}
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-primary hover:text-primary/80 mr-3 view-user" data-index="${startIndex + index}">
                                <i class="fa fa-info-circle mr-1"></i> 详情
                            </button>
                            <a href="${user.url}" target="_blank" class="text-gray-600 hover:text-gray-900">
                                <i class="fa fa-external-link mr-1"></i> B站
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // 添加查看详情事件监听
            document.querySelectorAll('.view-user').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    showUserDetail(filteredData[index], index + 1);
                });
            });
        }
        
        // 更新分页控件
        function updatePagination() {
            if (filteredData.length === 0) {
                pageInfo.textContent = '第 1 页，共 1 页';
                prevPage.disabled = true;
                nextPage.disabled = true;
                return;
            }
            
            const totalPages = Math.ceil(filteredData.length / pageSize);
            
            pageInfo.textContent = `第 ${currentPage} 页，共 ${totalPages} 页`;
            prevPage.disabled = currentPage === 1;
            nextPage.disabled = currentPage === totalPages;
        }
        
        // 显示用户详情
        function showUserDetail(user, rank) {
            modalUsername.textContent = user.name;
            modalAvatar.src = user.avatar;
            modalAvatar.alt = user.name;
            modalAvatar.onerror = function() {
                this.src = 'https://picsum.photos/200/200?random=' + user.mid;
            };
            modalMid.textContent = `UID: ${user.mid}`;
            modalUrl.href = user.url;
            modalFollower.textContent = formatNumber(user.follower);
            modalRank.textContent = `#${rank}`;
            
            // 格式化JSON数据
            const formattedJson = JSON.stringify(user, null, 2);
            modalJson.textContent = formattedJson;
            
            // 显示模态框
            userModal.classList.remove('hidden');
        }
        
        // 格式化数字
        function formatNumber(num) {
            if (typeof num === 'string') {
                num = parseInt(num);
            }
            
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            } else {
                return num.toString();
            }
        }
        
        // 根据粉丝数获取颜色
        function getFollowerColor(follower) {
            const num = parseInt(follower);
            
            if (num >= 1000000) {
                return 'text-red-600';
            } else if (num >= 100000) {
                return 'text-orange-500';
            } else if (num >= 10000) {
                return 'text-blue-500';
            } else {
                return 'text-gray-600';
            }
        }
        
        // 根据粉丝数获取徽章
        function getFollowerBadge(follower) {
            const num = parseInt(follower);
            
            if (num >= 1000000) {
                return '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">百万粉</span>';
            } else if (num >= 100000) {
                return '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800">十万粉</span>';
            } else if (num >= 10000) {
                return '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">万粉</span>';
            } else {
                return '';
            }
        }
        
        // 显示加载状态
        function showLoading() {
            userList.innerHTML = `
                <tr>
                    <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <i class="fa fa-spinner fa-spin text-4xl mb-4 text-gray-300"></i>
                            <p>正在加载用户数据...</p>
                        </div>
                    </td>
                </tr>
            `;
        }
    </script>
</body>
</html>